/* ===========================
   Aurora Night UI Theme
   - Glassy chat bubbles w/ tails
   - Animated aurora background
   - Subtle motion + refined buttons
   - Preserves your role alignment & POP notes UI
   =========================== */

:root{
  --bg-1:#0b1022;
  --bg-2:#0d1430;
  --bg-3:#0a122b;
  --panel: rgba(25,34,63,0.65);
  --panel-2: rgba(30,42,85,0.65);
  --glass-border: rgba(160,190,255,0.12);
  --text:#e9efff;
  --text-dim:#a9b4cf;
  --accent:#7eb6ff;
  --accent-2:#a9dcff;
  --accent-3:#6ef0e3;
  --success:#22c55e;
  --danger:#ef4444;
  --muted:#2a3766;
  --border:#2b3661;
  --shadow: 0 10px 24px rgba(0,0,0,0.35), 0 2px 6px rgba(0,0,0,0.28);
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:8px}
::selection{background:rgba(126,182,255,.25)}

#app-root{height:100%;display:flex;align-items:stretch}

/* Animated aurora background */
body{
  background:
   radial-gradient(1200px 800px at -10% -10%, rgba(110,240,227,.12), transparent 60%),
   radial-gradient(1000px 700px at 110% 10%, rgba(126,182,255,.10), transparent 60%),
   linear-gradient(180deg,var(--bg-1),var(--bg-2) 60%,var(--bg-3));
  background-attachment: fixed;
  animation: auroraShift 18s ease-in-out infinite alternate;
}
@keyframes auroraShift{
  0%{background-position: 0 0, 0 0, 0 0}
  100%{background-position: 30px -20px, -20px 20px, 0 0}
}

/* ===== App Frame ===== */
.app{
  width:100%;
  display:grid;
  grid-template-rows:auto 1fr auto;
}

.header{
  padding:14px 16px;
  background:linear-gradient(180deg, rgba(12,20,44,.85), rgba(10,16,36,.75));
  border-bottom:1px solid var(--glass-border);
  backdrop-filter: blur(8px);
  position:sticky; top:0; z-index:5;
}
.header h1{margin:0;font-size:15px;letter-spacing:.4px;color:var(--accent-2);font-weight:700}

/* ===== Main / Chat ===== */
.main{
  display:grid; grid-template-columns:1fr;
  height:calc(100vh - 140px); overflow:hidden;
}

.chat{
  height:100%; overflow:auto;
  padding:22px 18px 120px;
  display:flex; flex-direction:column; gap:14px;
  scrollbar-width: thin; scrollbar-color: #445389 transparent;
}
.chat::-webkit-scrollbar{width:10px}
.chat::-webkit-scrollbar-thumb{
  background:linear-gradient(180deg,#4a5a8a,#2f3d6c);
  border-radius:10px; border:2px solid transparent; background-clip:padding-box;
}
.chat::-webkit-scrollbar-track{background:transparent}

/* ===== Message Bubble ===== */
.message{
  position:relative;
  max-width:min(72%, 880px);
  padding:12px 14px;
  line-height:1.55;
  border-radius:18px;
  border:1px solid var(--glass-border);
  background: linear-gradient(180deg, var(--panel), var(--panel-2));
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow);
  transform-origin: var(--origin, center);
  animation: floatIn .22s ease-out;
}
@keyframes floatIn{
  from{opacity:0; transform: translateY(6px) scale(.995)}
  to{opacity:1; transform: translateY(0) scale(1)}
}

/* USER → RIGHT */
.message[data-role="user"]{
  align-self:flex-end;
  margin:0 56px 0 8px;
  --origin:right bottom;
}
.message[data-role="user"]::after{
  content:""; position:absolute; right:-7px; bottom:10px;
  border-width:8px 0 8px 8px; border-style:solid;
  border-color:transparent transparent transparent var(--panel-2);
  filter: drop-shadow(0 2px 2px rgba(0,0,0,.2));
}

/* ASSISTANT → LEFT */
.message[data-role="assistant"]{
  align-self:flex-start;
  margin:0 8px 0 56px;
  --origin:left bottom;
}
.message[data-role="assistant"]::before{
  content:""; position:absolute; left:-7px; bottom:10px;
  border-width:8px 8px 8px 0; border-style:solid;
  border-color:transparent var(--panel-2) transparent transparent;
  filter: drop-shadow(0 2px 2px rgba(0,0,0,.2));
}

/* SYSTEM → LEFT (subdued glass) */
.message[data-role="system"]{
  align-self:flex-start;
  max-width:min(85%,1000px);
  margin:6px 8px 6px 56px;
  background: linear-gradient(180deg, rgba(16,26,51,.6), rgba(16,26,51,.5));
  border-style:dashed;
}

/* POP (merged notes) — center aligned via UI-only class */
.message.is-pop{
  align-self:center !important;
  background: linear-gradient(180deg, rgba(16,26,62,.6), rgba(16,26,62,.5));
  border:1px dashed var(--glass-border);
  max-width:min(80%, 1000px);
  margin:6px auto;
}

/* Meta (role label) */
.message .meta{
  font-size:11px; color:var(--text-dim); margin-bottom:6px; letter-spacing:.3px;
  text-transform:uppercase;
}
.message[data-role="assistant"] .meta,
.message[data-role="system"] .meta{ text-align:left }
.message[data-role="user"] .meta{ text-align:right }
.message.is-pop .meta{ text-align:center }

/* Content */
.message .content{ white-space:pre-wrap; word-break:break-word; }

/* Inline message actions (Edit for user) */
.msg-actions{ display:flex; gap:6px; margin-top:8px }
.message[data-role="user"] .msg-actions{ justify-content:flex-end }

/* Edit area */
.edit-area{ display:grid; gap:8px }
.editbox{
  width:100%; min-height:88px; resize:vertical;
  background: rgba(14,20,44,.7);
  border:1px solid var(--glass-border);
  color:var(--text); border-radius:12px; padding:10px 12px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
}

/* ===== Buttons ===== */
.btn{
  height:68px; padding:0 18px;
  background: linear-gradient(180deg, var(--accent), #6ca7ff);
  color:#0b1222; border:0; border-radius:12px;
  font-weight:700; cursor:pointer;
  box-shadow: 0 8px 22px rgba(126,182,255,.25);
  transition: transform .12s ease, filter .12s ease, box-shadow .12s ease, opacity .12s ease;
}
.btn:hover{ transform: translateY(-1px); filter:saturate(1.05); box-shadow:0 10px 26px rgba(126,182,255,.33) }
.btn:active{ transform: translateY(0) scale(.99) }
.btn:disabled{opacity:.6; cursor:not-allowed}

.btn.micro{
  height:26px; line-height:24px; padding:0 10px; font-size:12px; border-radius:8px;
  background: linear-gradient(180deg, #5e77b8, #4a5ea0); color:#eaf1ff;
  box-shadow:none;
}
.btn.secondary{ background: linear-gradient(180deg, #4a5ea0, #3d528f); color:#eaf1ff }
.btn.success{ background: linear-gradient(180deg, #3bd97a, #22c55e); color:white }
.btn.danger{ background: linear-gradient(180deg, #ff6a6a, #ef4444); color:white }

/* ===== Composer ===== */
.composer{
  position:sticky; bottom:0; z-index:4;
  padding:14px;
  background: linear-gradient(0deg, rgba(12,18,40,.9), rgba(14,20,44,.85));
  border-top:1px solid var(--glass-border);
  display:grid; grid-template-columns:1fr auto; gap:10px;
  backdrop-filter: blur(8px);
  animation: slideUp .25s ease-out;
}
@keyframes slideUp{ from{ transform: translateY(6px); opacity:.95 } to{ transform: translateY(0); opacity:1 } }

.composer textarea{
  width:100%; height:72px; resize:vertical;
  background: rgba(20,28,58,.6);
  border:1px solid var(--glass-border);
  color:var(--text); border-radius:12px; padding:12px 14px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
}

/* ===== Ask pill (selection.js) ===== */
.ask-pill{
  position:fixed; z-index:1000;
  background: linear-gradient(180deg, var(--accent-3), var(--accent));
  color:#051224; border:0; border-radius:999px;
  padding:9px 14px; font-weight:800; letter-spacing:.2px;
  box-shadow:0 14px 34px rgba(110,240,227,.35), 0 4px 12px rgba(0,0,0,.25);
  cursor:pointer; user-select:none;
  transform: translateZ(0);
}
.ask-pill:hover{ filter:saturate(1.08) }

/* ===== Popup (draggable) ===== */
.popup{
  position:fixed; z-index:999; width:440px; max-width:92vw;
  background: linear-gradient(180deg, rgba(12,20,44,.8), rgba(10,18,40,.72));
  border:1px solid var(--glass-border);
  border-radius:16px; box-shadow: var(--shadow);
  display:grid; grid-template-rows:auto 1fr auto auto; overflow:hidden;
  backdrop-filter: blur(14px);
  animation: floatIn .22s ease-out;
}
.popup .titlebar{
  background: linear-gradient(180deg, rgba(9,16,34,.9), rgba(9,16,34,.75));
  color:var(--text); padding:10px 12px; cursor:move;
  display:flex; align-items:center; gap:8px; border-bottom:1px solid var(--glass-border);
}
.popup .titlebar .badge{
  background: rgba(85,104,170,.4); color:var(--text-dim);
  padding:2px 8px; border-radius:20px; font-size:12px;
}
.popup .stream{
  padding:10px 12px; white-space:pre-wrap; overflow:auto;
  border-bottom:1px solid var(--glass-border);
  min-height:160px; max-height:260px;
}
.popup .question{ padding:8px 12px; border-bottom:1px solid var(--glass-border) }
.popup .question textarea{
  width:100%; height:80px; resize:vertical;
  background: rgba(18,26,54,.7); border:1px solid var(--glass-border);
  color:var(--text); border-radius:12px; padding:9px 12px;
}
.popup .actions{ padding:10px 12px; display:flex; gap:8px }
.popup .actions .btn{ height:40px; padding:0 14px }

/* ===== POP notes (compact one-liner + dropdown) ===== */
.notes{ margin:0 }
.notes summary.notes-summary{
  display:flex; align-items:center; gap:10px; list-style:none; cursor:pointer;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  color:var(--accent-2); padding:4px 0; position:relative;
}
.notes .tag{
  background: rgba(85,104,170,.35);
  color:var(--text-dim);
  padding:3px 8px; border-radius:999px; font-size:11px; flex:0 0 auto;
  border:1px solid var(--glass-border);
}
.notes .preview{ flex:1 1 auto; min-width:0 }
.notes .notes-body{
  margin-top:10px; border-top:1px dashed var(--glass-border);
  padding-top:10px; color:var(--text);
}
.notes .notes-body pre{ margin:0; white-space:pre-wrap }

/* Custom dropdown chevron */
.notes summary.notes-summary::-webkit-details-marker{ display:none }
.notes summary.notes-summary::after{
  content:"▾"; font-size:12px; color:var(--text-dim); margin-left:6px; flex:0 0 auto;
}
details[open] > summary.notes-summary::after{ transform: rotate(180deg) }

/* Delete on POP line (right aligned) */
.notes .notes-delete{
  flex:0 0 auto; margin-left:auto;
  background: rgba(255,255,255,.02);
  color:var(--text-dim);
  border:1px solid var(--glass-border);
  border-radius:8px; padding:0 8px; line-height:22px; height:22px;
  cursor:pointer; font-weight:800;
  transition: background .12s ease, border-color .12s ease, color .12s ease, transform .12s ease;
}
.notes .notes-delete:hover{
  background: rgba(255,255,255,.06);
  color:#fff; border-color:#4a5ea0; transform: translateY(-1px);
}

/* ===== Small utility tweaks ===== */
a{ color:var(--accent-2) }
/* Floating Ask pill (selection.js) */
.ask-pill{
  position:fixed;
  z-index:3000;            /* ensure above popups */
  background: linear-gradient(180deg, var(--accent-3), var(--accent));
  color:#051224;
  border:0;
  border-radius:999px;
  padding:9px 14px;
  font-weight:800;
  letter-spacing:.2px;
  box-shadow:0 14px 34px rgba(110,240,227,.35), 0 4px 12px rgba(0,0,0,.25);
  cursor:pointer;
  user-select:none;
  transform: translateZ(0);
}
.ask-pill:hover{ filter:saturate(1.08) }
